// ==UserScript==
// @name               Easy Compare
// @description        Compare images
// @version            0.8.1
// @author             Secant (TYT@NexusHD)
// @license            GPL-3.0-or-later
// @supportURL         zzwu@zju.edu.cn
// @contributionURL    https://i.loli.net/2020/02/28/JPGgHc3UMwXedhv.jpg
// @contributionAmount 10
// @include            *
// @require            https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js
// @require            https://bundle.run/pixelmatch@5.1.0
// @namespace          https://greasyfork.org/users/152136
// @icon               data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23008000'%3E%3Cpath id='ld' d='M20 6H10c-2.21 0-4 1.79-4 4v28c0 2.21 1.79 4 4 4h10v4h4V2h-4v4zm0 30H10l10-12v12zM38 6H28v4h10v26L28 24v18h10c2.21 0 4-1.79 4-4V10c0-2.21-1.79-4-4-4z'/%3E%3C/svg%3E
// @grant              GM_xmlhttpRequest
// @grant              GM_download
// @grant              unsafewindow
// @connect            hdbits.org
// @connect            awesome-hd.me
// @connect            ptpimg.me
// @connect            imgbox.com
// @connect            malzo.com
// @connect            imagebam.com
// @connect            pixhost.to
// @connect            loli.net
// @connect            funkyimg.com
// @connect            ilikeshots.club
// @connect            z4a.net
// @connect            picgd.com
// @connect            tu.totheglory.im
// @connect            tpimg.ccache.org
// @connect            pterclub.com
// @connect            catbox.moe
// @connect            *
// ==/UserScript==
(async function (e, t, a, r) { "use strict"; async function o(e, t, a, r) { return new Promise(o => { e.onmessage = (e => { o(e.data.result) }), e.postMessage({ R: t.buffer, G: a.buffer, B: r.buffer }, [t.buffer, a.buffer, r.buffer]) }) } function n(t) { return e(t, document.implementation.createHTMLDocument("virtual")) } function s(e, t, a = 20) { return `data:image/svg+xml,${encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' height="${a}" width="${t}">` + `<text x="0" y="15" fill="white" font-family="sans serif">${e}</text>` + "</svg>")}` } function i(t, a = "red") { const r = e("<figure/>").css({ width: "fit-content", position: "fixed", top: "50%", left: "50%", margin: "0", "vertical-align": "middle" }), o = e(`<img src="${t}"/>`).css({ display: "none", transform: "translate(-50%, -50%)", opacity: "1", outline: "3px solid " + a, "outline-offset": "2px" }); return r.append(o), o } function c(t = "red") { const a = e("<figure/>").css({ width: "fit-content", position: "fixed", top: "50%", left: "50%", margin: "0", "vertical-align": "middle" }), r = e("<canvas/>").css({ display: "none", transform: "translate(-50%, -50%)", opacity: "1", outline: "3px solid " + t, "outline-offset": "2px" }); a.append(r); const o = r[0], n = o.getContext("2d"); return { canvas: o, context: n } } function l(e) { return new Promise(t => { GM_xmlhttpRequest({ url: e, method: "GET", timeout: 6e3, onload: e => { if (200 === e.status) try { const a = n(e.responseText), r = a.find($.join(","))[0].src; let o = r; for (let e of I) if (o = o.replace(e[0], e[1]), o !== r) break; t(o) } catch (e) { console.warn(e), t(null) } else console.warn(e), t(null) }, ontimeout: e => { console.warn(e), t(null) } }) }) } function d(e, t, a, r, o) { const [n, s, i] = o; for (let o = 0; o < r; ++o)for (let r = 0; r < a; ++r) { let c = 4 * r + o * a * 4; t[c] = n[e[c]], t[c + 1] = s[e[c + 1]], t[c + 2] = i[e[c + 2]], t[c + 3] = e[c + 3] } } async function f(e, t) { return new Promise(a => { GM_xmlhttpRequest({ url: e, method: "GET", overrideMimeType: "text/plain; charset=x-user-defined", onprogress: e => { "function" == typeof t && (-1 !== e.total ? t(e.loaded / e.total) : t(-e.loaded)) }, onload: e => { if (200 === e.status) { const t = e.responseText, r = t.length, o = new Uint8Array(r); for (let e = 0; e < r; e++)o[e] = 255 & t.charCodeAt(e); const n = (e.responseHeaders.match(/content\-type: *(.+)(\n|$)/) || [, "image/png"])[1]; createImageBitmap(new Blob([o], { type: n })).then(e => { const [t, r] = [e.width, e.height], o = document.createElement("canvas"); o.width = t, o.height = r; const n = o.getContext("2d"); n.drawImage(e, 0, 0), e.close(), a(new ImageData(n.getImageData(0, 0, t, r).data, t, r)) }) } else console.warn(e), a(null) }, onerror: e => { console.warn(e), a(null) } }) }) } async function p(e, t, r, o = { alpha: .5, threshold: .007 }, n = D) { const [s, i] = await Promise.all([f(e, e => r(e, 0)), f(t, e => r(e, 1))]); if (s && i && s.width === i.width && s.height === i.height) { if (r(null, null), n) { const [e, t, a, r] = [s.data.buffer, i.data.buffer, s.width, s.height], c = "" + Date.now(); return n.onmessage = (e => { const t = e.data.key, o = n.keyPool[t]; o && o(new ImageData(new Uint8ClampedArray(e.data.diff), a, r)) }), n.postMessage({ img1: e, img2: t, width: a, height: r, init: o, key: c }, [e, t]), new Promise(e => { n.keyPool[c] = e }) } { const [e, t, r, n] = [s.data, i.data, s.width, s.height], c = new Uint8ClampedArray(e); return a(e, t, c, r, n, o), new ImageData(c, r, n) } } return null } async function h(e, t, a) { const r = await f(e, t); if (r) { if (t(null), a instanceof Worker) { const e = a, [t, o, n] = [r.data.buffer, r.width, r.height], s = "" + Date.now(); return e.onmessage = (t => { const a = t.data.key, r = e.keyPool[a]; r && r(new ImageData(new Uint8ClampedArray(t.data.filter), o, n)) }), await F, e.postMessage({ img: t, width: o, height: n, key: s }, [t]), new Promise(t => { e.keyPool[s] = t }) } { const e = a, [t, o, n] = [r.data, r.width, r.height], s = new Uint8ClampedArray(t); return d(t, s, o, n, e), new ImageData(s, o, n) } } return null } function g(e, t) { if (e.easyCompare && e.easyCompare.originalImage) { const t = e.easyCompare.originalImage; return t.ready && (t.style.width = `${100 * v}%`), t } { const a = i(s("Loading...", 80))[0]; return a.ready = !1, a.targetImage = e, t.append(a.parentElement), e.easyCompare || (e.easyCompare = {}), e.easyCompare.originalImage = a, e.easyCompare.originalImagePromise = new Promise(t => { let r, o, n = e.src; for (let r of I) if (n = n.replace(r[0], r[1]), n !== e.src) return a.src = n, a.style.width = `${100 * v}%`, a.ready = !0, void t(a); if (o = e.parentElement.href, !(r = o)) return a.src = n, a.style.width = `${100 * v}%`, a.ready = !0, void t(a); for (let e of T) if (r = r.replace(e[0], e[1]), r !== o) break; if (r.match(/\.png$|\.jpe?g$|\.webp|\.gif|\.bmp|\.svg$/)) return a.src = r, a.style.width = `${100 * v}%`, a.ready = !0, void t(a); l(r).then(e => { a.src = e || n, a.style.width = `${100 * v}%`, a.ready = !0, t(a) }) }), a } } function m(e, t, a) { if (e.src === t.src) return g(e); if (e.easyCompare && e.easyCompare[t.src]) { e.easyCompare[t.src].targetImage = e, e.easyCompare[t.src].baseImage = t; const a = e.easyCompare[t.src]; return a.ready && (a.style.width = `${100 * v}%`), a } { const { canvas: r, context: o } = c(); r.width = 80, r.height = 20, o.font = "16px sans serif", o.fillStyle = "rgba(255, 255, 255, 255)", o.fillText("Loading...", 0, 15), r.ready = !1, r.targetImage = e, r.baseImage = t, r.threshold = -1, r.step = .001, a.append(r.parentElement), e.easyCompare || (e.easyCompare = {}), e.easyCompare[t.src] = r, t.easyCompare || (t.easyCompare = {}), t.easyCompare[e.src] = r; let n = [0, 0]; const s = (e, t) => { null !== e && e >= 0 && null !== t ? (n[t] = e, r.width = 120, o.font = "16px sans serif", o.fillStyle = "rgba(255, 255, 255, 255)", o.fillText(`Loading ${(50 * (n[0] + n[1])).toFixed(1)}%`, 0, 15)) : e < 0 ? (r.width = 80, o.font = "16px sans serif", o.fillStyle = "rgba(255, 255, 255, 255)", o.fillText("Loading...", 0, 15)) : (r.width = 80, o.font = "16px sans serif", o.fillStyle = "rgba(255, 255, 255, 255)", o.fillText("Diffing...", 0, 15)) }; return g(e, a), g(t, a), Promise.all([e.easyCompare.originalImagePromise, t.easyCompare.originalImagePromise]).then(([{ src: e }, { src: t }]) => p(e, t, s, { alpha: .5, threshold: .007 })).then(e => { null === e ? (r.width = 120, o.fillText("Sizes Not Match", 0, 15)) : (r.width = e.width, r.height = e.height, o.putImageData(e, 0, 0), r.threshold = .007, r.style.width = `${100 * v}%`, r.ready = !0) }).catch(e => { console.warn(e), r.width = 120, o.fillText("Sth. Went Wrong", 0, 15) }), r } } function y(e, t, a) { if (e.easyCompare && e.easyCompare[t]) { const a = e.easyCompare[t]; return a.ready && (a.style.width = `${100 * v}%`), a } { const { canvas: r, context: o } = c(); r.width = 80, r.height = 20, o.font = "16px sans serif", o.fillStyle = "rgba(255, 255, 255, 255)", o.fillText("Loading...", 0, 15), r.ready = !1, r.targetImage = e, a.append(r.parentElement), e.easyCompare || (e.easyCompare = {}), e.easyCompare[t] = r; const n = e => { null !== e && e >= 0 ? (r.width = 120, o.font = "16px sans serif", o.fillStyle = "rgba(255, 255, 255, 255)", o.fillText(`Loading ${(100 * e).toFixed(1)}%`, 0, 15)) : e < 0 ? (r.width = 80, o.font = "16px sans serif", o.fillStyle = "rgba(255, 255, 255, 255)", o.fillText("Loading...", 0, 15)) : (r.width = 80, o.font = "16px sans serif", o.fillStyle = "rgba(255, 255, 255, 255)", o.fillText("Filtering...", 0, 15)) }; return g(e, a), e.easyCompare.originalImagePromise.then(e => { U[t](e.src, n).then(e => { r.width = e.width, r.height = e.height, o.putImageData(e, 0, 0), r.style.width = `${100 * v}%`, r.ready = !0 }) }), r } } function u(e) { return e.find("img:visible,canvas:visible") } function w(e) { e.attr({ fill: "#008000" }).css({ cursor: "pointer", opacity: "1" })[0].state = !0 } function b(t, a) { const r = u(t).hide()[0]; (r && (a = r.targetImage) || a) && a.easyCompare && void 0 !== a.easyCompare.boxShadow && e(a).css("box-shadow", a.easyCompare.boxShadow) } function x(a, r, o) { t && t.pause(), a.show()[0].state = !0; let n, s = ["red", "blue"], i = 1, c = "none"; r.on("mouseenter.compare", (t, r) => { const o = t.currentTarget; let i; if (clearTimeout(C), b(a), o.easyCompare || (o.easyCompare = {}, o.easyCompare.boxShadow = o.style["box-shadow"]), e(o).css({ "box-shadow": "0px 0px 8px " + s[0] }), (t.shiftKey || r) && n) i = e(m(o, n, a)).css("outline-color", s[0]).show(); else switch (c) { case "none": i = e(g(o, a)).css("outline-color", s[0]).show(); break; default: i = e(y(o, c, a)).css("outline-color", s[0]).show() }s.push(s.shift()) }).on("mouseleave.compare", e => { const t = e.currentTarget; C = setTimeout(() => { b(a, t) }, 200) }), e(document).on("scroll.compare", t => { const o = u(a)[0]; if (o) { const t = e(o.targetImage); t.is(":hover") || (b(a, t[0]), r.find("img:hover").trigger("mousenter")) } }).on("keydown.compare", t => { switch (t.preventDefault(), t.stopImmediatePropagation(), t.key) { case "Escape": k(a, r); break; case "Shift": try { const e = r.index(u(a)[0].targetImage); n = r[e] } catch (e) { n = void 0, e instanceof TypeError || console.warn(e) } break; case "+": case "=": if (t.ctrlKey) try { v <= .9 ? v += .1 : v = 1; const e = u(a)[0]; e.ready && (e.style.width = `${100 * v}%`) } catch (e) { e instanceof TypeError || console.warn(e) } break; case "-": case "_": if (t.ctrlKey) try { v >= .2 ? v -= .1 : v = .1; const e = u(a)[0]; e.ready && (e.style.width = `${100 * v}%`) } catch (e) { e instanceof TypeError || console.warn(e) } break; case "O": case "o": if (t.ctrlKey) try { if (1 !== v) { v = 1; const e = u(a)[0]; e.ready && (e.style.width = `${100 * v}%`) } } catch (e) { e instanceof TypeError || console.warn(e) } break; case "S": case "s": if (t.ctrlKey) try { const e = u(a)[0]; let t; switch (e.nodeName) { case "IMG": t = e.src; break; case "CANVAS": t = e.toDataURL("image/png").replace(/^data:image\/[^;]/, "data:application/octet-stream") }GM_download({ url: t, name: "easycompare.png" }) } catch (e) { e instanceof TypeError || console.warn(e) } else { c = "solar" === c ? "none" : "solar"; try { const t = u(a).hide()[0]; let r; r = e("none" === c ? g(t.targetImage, a) : y(t.targetImage, c, a)), r.css("outline-color", t.style["outline-color"]).show() } catch (e) { e instanceof TypeError || console.warn(e) } } break; case "A": case "a": c = "s2lar" === c ? "none" : "s2lar"; try { const t = u(a).hide()[0]; let r; r = e("none" === c ? g(t.targetImage, a) : y(t.targetImage, c, a)), r.css("outline-color", t.style["outline-color"]).show() } catch (e) { e instanceof TypeError || console.warn(e) } break; case "I": case "i": case "ArrowUp": try { const e = u(a)[0]; let t = e.threshold; if (void 0 !== t && t >= 0) { const a = t; o.text(`Threshold: ${a.toFixed(4)}`).css("opacity", "1"), t += e.step, t > 1 && (t = 1), e.threshold = -1, p(e.baseImage.easyCompare.originalImage.src, e.targetImage.easyCompare.originalImage.src, () => { }, { alpha: .5, threshold: t }).then(a => { e.getContext("2d").putImageData(a, 0, 0), o.text(`Threshold: ${t.toFixed(4)}`).css("opacity", "1"), setTimeout(() => { e.threshold = t, o.css("opacity", "0") }, 300) }) } } catch (e) { e instanceof TypeError || console.warn(e) } break; case "K": case "k": case "ArrowDown": try { const e = u(a)[0]; let t = e.threshold; if (void 0 !== t && t >= 0) { const a = t; o.text(`Threshold: ${a.toFixed(4)}`).css("opacity", "1"), t -= e.step, t < 0 && (t = 0), e.threshold = -1, p(e.baseImage.easyCompare.originalImage.src, e.targetImage.easyCompare.originalImage.src, () => { }, { alpha: .5, threshold: t }).then(a => { e.getContext("2d").putImageData(a, 0, 0), o.text(`Threshold: ${t.toFixed(4)}`).css("opacity", "1"), setTimeout(() => { e.threshold = t, o.css("opacity", "0") }, 300) }) } } catch (e) { e instanceof TypeError || console.warn(e) } break; case "J": case "j": case "ArrowLeft": try { const e = u(a)[0]; switch (e.step) { case 1e-4: e.step = .001; break; case .001: e.step = .01; break; case .01: e.step = .1; break; case .1: e.step = 1 }e.step && (o.text(`Step: ${e.step.toFixed(4)}`).css("opacity", "1"), setTimeout(() => o.css("opacity", "0"), 300)) } catch (e) { e instanceof TypeError || console.warn(e) } break; case "L": case "l": case "ArrowRight": if (t.ctrlKey) { try { b(a, u(a)[0].targetImage) } catch (e) { e instanceof TypeError || console.warn(e) } a.find("img,canvas").toArray().forEach(e => { const t = e.targetImage; delete t.easyCompare, e.parentElement.remove() }) } else try { const e = u(a)[0]; switch (e.step) { case 1: e.step = .1; break; case .1: e.step = .01; break; case .01: e.step = .001; break; case .001: e.step = 1e-4 }e.step && (o.text(`Step: ${e.step.toFixed(4)}`).css("opacity", "1"), setTimeout(() => o.css("opacity", "0"), 300)) } catch (e) { e instanceof TypeError || console.warn(e) } break; case "Q": case "q": a.css("opacity", .5); break; case "1": case "2": case "3": case "4": case "5": case "6": case "7": case "8": case "9": i = parseInt(t.key); break; case "0": i = 10; break; case "E": case "e": try { const o = u(a)[0].targetImage, n = r.index(o); b(a, o); const s = r[n + i] || r[n]; e(s).trigger("mouseenter", [t.shiftKey]) } catch (e) { e instanceof TypeError || console.warn(e) } break; case "W": case "w": try { const o = u(a)[0].targetImage, n = r.index(o); b(a, o); const s = r[n - i] || r[n]; e(s).trigger("mouseenter", [t.shiftKey]) } catch (e) { e instanceof TypeError || console.warn(e) } }return !1 }).on("keyup.compare", e => { switch (e.preventDefault(), e.stopImmediatePropagation(), e.key) { case "Q": case "q": a.css("opacity", "") }return !1 }) } function k(a, r) { t && t.unpause(), b(a), a.hide()[0].state = !1, r.off("mouseenter.compare").off("mouseleave.compare"), e(document).off("scroll.compare").off("keydown.compare") } if (t) { let e = t.prototype || t; const a = e.stopCallback; e.stopCallback = function (e, t, r) { var o = this; return !!o.paused || a.call(o, e, t, r) }, e.pause = function () { var e = this; e.paused = !0 }, e.unpause = function () { var e = this; e.paused = !1 } } let C, v = 1; const I = [[/\.thumb\.jpe?g$/, ""], [/\.md\.png$/, ".png"], [/\.th\.png$/, ".png"], [/_thumb\.png$/, ".png"], [/img\.awesome\-hd\.me\/t(\/\d+)?\//, "img.awesome-hd.me/images/"], [/thumbs((?:\d+)?\.imgbox\.com\/.+_)t\.png$/, "images$1o.png"], [/t((?:\d+)?\.pixhost\.to\/)thumbs\//, "img$1images/"], [/t(\.hdbits\.org\/.+)\.jpg$/, "i$1.png"], [/^.*?imagecache\.php\?url=(https?)%3A%2F%2Fthumbs(\d+)?\.imgbox\.com%2F(\w+)%2F(\w+)%2F(\w+)_t\.png/, "$1://images$2.imgbox.com/$3/$4/$5_o.png"]], T = [[/^https?:\/\/anonym\.to\/\?(.*)$/, (e, t) => decodeURIComponent(t)], [/^https?:\/\/www\.dereferer\.org\/\?(.*)$/, (e, t) => decodeURIComponent(t)], [/^(?:https?:\/\/pterclub\.com)?\/link\.php\?sign=.+?&target=(.*)$/, (e, t) => decodeURIComponent(t.replace(/\+/g, " ")).replace(/ /g, "%20")], [/^.*?imagecache\.php\?url=(.*)$/, (e, t) => decodeURIComponent(t.replace(/\+/g, " ")).replace(/ /g, "%20")]], $ = ["#image-viewer-container>img", ".image-container img", "div.img.big>img", "img.mainimage", "img#img"], U = { solar: (e, t) => h(e, t, S || [P, A, M]), s2lar: (e, t) => h(e, t, L || [j, E, R]) }, [P, A, M] = [new Uint8Array([0, 2, 9, 21, 37, 56, 78, 101, 125, 149, 172, 193, 212, 228, 241, 250, 254, 255, 252, 246, 235, 222, 206, 188, 168, 148, 127, 106, 86, 67, 49, 34, 22, 12, 5, 1, 0, 1, 6, 14, 24, 36, 50, 66, 82, 100, 118, 136, 154, 171, 188, 203, 216, 228, 238, 245, 251, 254, 255, 254, 251, 246, 239, 230, 219, 207, 194, 180, 165, 149, 134, 118, 103, 88, 73, 60, 48, 36, 26, 18, 11, 6, 2, 0, 0, 1, 4, 8, 14, 22, 30, 40, 51, 63, 75, 88, 102, 115, 129, 143, 156, 170, 182, 194, 205, 216, 225, 233, 240, 246, 250, 253, 255, 255, 254, 252, 248, 243, 237, 230, 221, 212, 201, 190, 179, 166, 154, 141, 128, 114, 101, 89, 76, 65, 54, 43, 34, 25, 18, 12, 7, 3, 1, 0, 0, 2, 5, 9, 15, 22, 30, 39, 50, 61, 73, 85, 99, 112, 126, 140, 153, 167, 180, 192, 204, 215, 225, 233, 241, 247, 251, 254, 255, 255, 253, 249, 244, 237, 229, 219, 207, 195, 182, 167, 152, 137, 121, 106, 90, 75, 61, 48, 36, 25, 16, 9, 4, 1, 0, 1, 4, 10, 17, 27, 39, 52, 67, 84, 101, 119, 137, 155, 173, 189, 205, 219, 231, 241, 249, 254, 255, 254, 250, 243, 233, 221, 206, 188, 169, 149, 128, 107, 87, 67, 49, 33, 20, 9, 3, 0, 1, 5, 14, 27, 43, 62, 83, 106, 130, 154, 177, 199, 218, 234, 246, 253]), new Uint8Array([60, 39, 22, 10, 2, 0, 2, 9, 21, 37, 56, 78, 101, 125, 149, 172, 193, 212, 228, 241, 250, 254, 255, 252, 246, 235, 222, 206, 188, 168, 148, 127, 106, 86, 67, 49, 34, 22, 12, 5, 1, 0, 1, 6, 14, 24, 36, 50, 66, 82, 100, 118, 136, 154, 171, 188, 203, 216, 228, 238, 245, 251, 254, 255, 254, 251, 246, 239, 230, 219, 207, 194, 180, 165, 149, 134, 118, 103, 88, 73, 60, 48, 36, 26, 18, 11, 6, 2, 0, 0, 1, 4, 8, 14, 22, 30, 40, 51, 63, 75, 88, 102, 115, 129, 143, 156, 170, 182, 194, 205, 216, 225, 233, 240, 246, 250, 253, 255, 255, 254, 252, 248, 243, 237, 230, 221, 212, 201, 190, 179, 166, 154, 141, 128, 114, 101, 89, 76, 65, 54, 43, 34, 25, 18, 12, 7, 3, 1, 0, 0, 2, 5, 9, 15, 22, 30, 39, 50, 61, 73, 85, 99, 112, 126, 140, 153, 167, 180, 192, 204, 215, 225, 233, 241, 247, 251, 254, 255, 255, 253, 249, 244, 237, 229, 219, 207, 195, 182, 167, 152, 137, 121, 106, 90, 75, 61, 48, 36, 25, 16, 9, 4, 1, 0, 1, 4, 10, 17, 27, 39, 52, 67, 84, 101, 119, 137, 155, 173, 189, 205, 219, 231, 241, 249, 254, 255, 254, 250, 243, 233, 221, 206, 188, 169, 149, 128, 107, 87, 67, 49, 33, 20, 9, 3, 0, 1, 5, 14, 27, 43, 62, 83, 106, 130, 154, 177]), new Uint8Array([56, 78, 101, 125, 149, 172, 193, 212, 228, 241, 250, 254, 255, 252, 246, 235, 222, 206, 188, 168, 148, 127, 106, 86, 67, 49, 34, 22, 12, 5, 1, 0, 1, 6, 14, 24, 36, 50, 66, 82, 100, 118, 136, 154, 171, 188, 203, 216, 228, 238, 245, 251, 254, 255, 254, 251, 246, 239, 230, 219, 207, 194, 180, 165, 149, 134, 118, 103, 88, 73, 60, 48, 36, 26, 18, 11, 6, 2, 0, 0, 1, 4, 8, 14, 22, 30, 40, 51, 63, 75, 88, 102, 115, 129, 143, 156, 170, 182, 194, 205, 216, 225, 233, 240, 246, 250, 253, 255, 255, 254, 252, 248, 243, 237, 230, 221, 212, 201, 190, 179, 166, 154, 141, 128, 114, 101, 89, 76, 65, 54, 43, 34, 25, 18, 12, 7, 3, 1, 0, 0, 2, 5, 9, 15, 22, 30, 39, 50, 61, 73, 85, 99, 112, 126, 140, 153, 167, 180, 192, 204, 215, 225, 233, 241, 247, 251, 254, 255, 255, 253, 249, 244, 237, 229, 219, 207, 195, 182, 167, 152, 137, 121, 106, 90, 75, 61, 48, 36, 25, 16, 9, 4, 1, 0, 1, 4, 10, 17, 27, 39, 52, 67, 84, 101, 119, 137, 155, 173, 189, 205, 219, 231, 241, 249, 254, 255, 254, 250, 243, 233, 221, 206, 188, 169, 149, 128, 107, 87, 67, 49, 33, 20, 9, 3, 0, 1, 5, 14, 27, 43, 62, 83, 106, 130, 154, 177, 199, 218, 234, 246, 253, 255, 253, 245, 233, 216])], [j, E, R] = [new Uint8Array([0, 9, 149, 222, 1, 251, 26, 170, 166, 22, 255, 25, 173, 169, 5, 177, 246, 253, 218, 83, 33, 250, 67, 90, 241, 15, 141, 225, 4, 180, 171, 5, 206, 212, 56, 2, 0, 2, 78, 241, 168, 0, 188, 194, 2, 156, 237, 34, 73, 254, 90, 27, 231, 169, 3, 62, 199, 246, 253, 246, 199, 83, 0, 128, 254, 84, 16, 207, 215, 22, 54, 237, 194, 14, 88, 251, 154, 0, 127, 252, 193, 78, 9, 0, 0, 2, 37, 125, 241, 206, 49, 24, 203, 230, 60, 14, 182, 252, 114, 0, 99, 251, 182, 16, 52, 231, 221, 67, 1, 83, 177, 234, 253, 253, 246, 218, 130, 27, 9, 128, 254, 173, 10, 61, 219, 225, 73, 3, 128, 254, 170, 22, 48, 207, 238, 66, 5, 148, 252, 212, 101, 21, 2, 0, 0, 9, 56, 149, 250, 206, 49, 14, 188, 246, 88, 1, 143, 255, 154, 7, 61, 233, 207, 36, 39, 219, 221, 67, 5, 106, 199, 246, 253, 253, 234, 154, 43, 9, 149, 254, 84, 9, 182, 233, 50, 25, 212, 225, 30, 60, 246, 154, 0, 148, 254, 149, 37, 2, 0, 2, 37, 172, 255, 106, 14, 216, 180, 0, 170, 230, 25, 85, 255, 75, 52, 254, 107, 5, 154, 246, 253, 246, 177, 27, 67, 254, 67, 90, 247, 22, 128, 233, 8, 180, 171, 12, 235, 149, 21, 0, 2, 56, 241, 106, 66, 239, 0, 225, 101, 73, 237, 1, 249, 49, 83, 234]), new Uint8Array([245, 5, 255, 56, 22, 60, 22, 37, 254, 22, 203, 88, 102, 221, 0, 233, 90, 84, 243, 20, 62, 154, 177, 106, 5, 128, 241, 10, 167, 192, 0, 201, 170, 6, 239, 82, 67, 255, 101, 0, 39, 60, 39, 2, 149, 246, 34, 100, 246, 36, 88, 255, 89, 22, 225, 167, 0, 155, 243, 67, 1, 83, 154, 177, 154, 83, 5, 49, 221, 205, 17, 75, 249, 153, 0, 114, 255, 129, 0, 165, 245, 66, 34, 222, 228, 78, 2, 22, 60, 60, 39, 2, 21, 149, 255, 148, 1, 118, 255, 134, 0, 115, 250, 179, 18, 39, 215, 237, 75, 4, 155, 255, 169, 33, 5, 62, 130, 177, 177, 154, 106, 27, 3, 87, 221, 231, 84, 4, 137, 253, 167, 22, 34, 190, 246, 102, 0, 118, 251, 171, 6, 67, 235, 228, 101, 9, 10, 39, 60, 60, 22, 0, 37, 172, 255, 148, 5, 100, 251, 165, 11, 75, 233, 212, 43, 15, 180, 249, 106, 1, 137, 255, 169, 20, 14, 83, 154, 177, 177, 130, 43, 0, 87, 233, 205, 17, 61, 237, 180, 9, 76, 248, 170, 1, 134, 251, 66, 34, 235, 193, 37, 2, 39, 60, 39, 2, 56, 212, 206, 5, 136, 239, 18, 102, 254, 76, 30, 241, 152, 4, 205, 206, 20, 43, 154, 177, 154, 62, 3, 169, 231, 10, 167, 204, 0, 190, 182, 2, 239, 82, 86, 250, 37, 10, 60, 39, 0, 149, 206, 6, 254, 26, 170, 166, 22, 255]), new Uint8Array([246, 0, 225, 101, 73, 237, 0, 241, 67, 83, 253, 233, 216, 253, 199, 1, 188, 155, 25, 255, 61, 76, 253, 40, 103, 238, 14, 106, 255, 172, 78, 56, 78, 193, 246, 67, 36, 245, 118, 8, 216, 190, 3, 140, 244, 25, 101, 254, 67, 27, 177, 255, 233, 216, 233, 255, 199, 43, 33, 233, 173, 1, 137, 251, 73, 12, 190, 240, 63, 26, 207, 228, 36, 34, 188, 254, 193, 101, 56, 56, 78, 149, 228, 246, 106, 1, 100, 251, 165, 11, 63, 233, 221, 54, 15, 167, 249, 106, 1, 137, 254, 128, 3, 62, 199, 253, 245, 216, 216, 233, 253, 234, 130, 14, 33, 206, 241, 67, 9, 152, 254, 140, 5, 65, 230, 225, 75, 6, 134, 254, 154, 14, 49, 188, 255, 212, 125, 78, 56, 56, 101, 172, 241, 235, 106, 1, 82, 245, 194, 26, 30, 205, 243, 89, 2, 126, 255, 137, 1, 119, 255, 128, 3, 83, 218, 255, 233, 216, 216, 245, 246, 154, 14, 49, 233, 173, 4, 106, 255, 112, 1, 154, 253, 88, 11, 194, 228, 36, 49, 222, 241, 149, 78, 56, 78, 149, 250, 206, 22, 82, 254, 103, 22, 225, 179, 1, 153, 229, 16, 137, 233, 20, 83, 246, 233, 216, 233, 253, 130, 3, 206, 155, 25, 253, 73, 65, 255, 51, 103, 238, 6, 148, 241, 125, 56, 78, 172, 246, 22, 154, 180, 14, 253, 43, 140, 182, 39, 243, 0, 199, 245, 216, 245, 177, 3, 254])]; let D, S, L, F; const G = 'const defaultOptions={threshold:.1,includeAA:!1,alpha:.1,aaColor:[255,255,0],diffColor:[255,0,0],diffMask:!1};function pixelmatch(a,b,c,d,e,f){if(!isPixelData(a)||!isPixelData(b)||c&&!isPixelData(c))throw new Error("Image data: Uint8Array, Uint8ClampedArray or Buffer expected.");if(a.length!==b.length||c&&c.length!==a.length)throw new Error("Image sizes do not match.");if(a.length!==4*(d*e))throw new Error("Image data size does not match width/height.");f=Object.assign({},defaultOptions,f);const g=d*e,h=new Uint32Array(a.buffer,a.byteOffset,g),j=new Uint32Array(b.buffer,b.byteOffset,g);let k=!0;for(let l=0;l<g;l++)if(h[l]!==j[l]){k=!1;break}if(k){if(c&&!f.diffMask)for(let b=0;b<g;b++)drawGrayPixel(a,4*b,f.alpha,c);return 0}const l=35215*f.threshold*f.threshold;let m=0;const[n,o,p]=f.aaColor,[q,r,s]=f.diffColor;for(let g=0;g<e;g++)for(let h=0;h<d;h++){const i=4*(g*d+h),j=colorDelta(a,b,i,i);j>l?!f.includeAA&&(antialiased(a,h,g,d,e,b)||antialiased(b,h,g,d,e,a))?c&&!f.diffMask&&drawPixel(c,i,n,o,p):(c&&drawPixel(c,i,q,r,s),m++):c&&!f.diffMask&&drawGrayPixel(a,i,f.alpha,c)}return m}function isPixelData(a){return ArrayBuffer.isView(a)&&1===a.constructor.BYTES_PER_ELEMENT}function antialiased(a,b,c,d,e,f){const g=Math.max(b-1,0),h=Math.max(c-1,0),i=Math.min(b+1,d-1),j=Math.min(c+1,e-1);let k,l,m,n,o=b===g||b===i||c===h||c===j?1:0,p=0,q=0;for(let r=g;r<=i;r++)for(let e=h;e<=j;e++){if(r===b&&e===c)continue;const f=colorDelta(a,a,4*(c*d+b),4*(e*d+r),!0);if(0!==f)f<p?(p=f,k=r,l=e):f>q&&(q=f,m=r,n=e);else if(o++,2<o)return!1}return 0!==p&&0!==q&&(hasManySiblings(a,k,l,d,e)&&hasManySiblings(f,k,l,d,e)||hasManySiblings(a,m,n,d,e)&&hasManySiblings(f,m,n,d,e))}function hasManySiblings(a,b,c,d,e){const f=Math.max(b-1,0),g=Math.max(c-1,0),h=Math.min(b+1,d-1),i=Math.min(c+1,e-1),j=4*(c*d+b);let k=b===f||b===h||c===g||c===i?1:0;for(let l=f;l<=h;l++)for(let e=g;e<=i;e++){if(l===b&&e===c)continue;const f=4*(e*d+l);if(a[j]===a[f]&&a[j+1]===a[f+1]&&a[j+2]===a[f+2]&&a[j+3]===a[f+3]&&k++,2<k)return!0}return!1}function colorDelta(a,b,c,d,e){let f=a[c+0],g=a[c+1],h=a[c+2],j=a[c+3],k=b[d+0],l=b[d+1],m=b[d+2],n=b[d+3];if(j===n&&f===k&&g===l&&h===m)return 0;255>j&&(j/=255,f=blend(f,j),g=blend(g,j),h=blend(h,j)),255>n&&(n/=255,k=blend(k,n),l=blend(l,n),m=blend(m,n));const o=rgb2y(f,g,h)-rgb2y(k,l,m);if(e)return o;const p=rgb2i(f,g,h)-rgb2i(k,l,m),i=rgb2q(f,g,h)-rgb2q(k,l,m);return .5053*o*o+.299*p*p+.1957*i*i}function rgb2y(a,c,d){return .29889531*a+.58662247*c+.11448223*d}function rgb2i(a,c,d){return .59597799*a-.2741761*c-.32180189*d}function rgb2q(a,c,d){return .21147017*a-.52261711*c+.31114694*d}function blend(b,c){return 255+(b-255)*c}function drawPixel(a,c,d,e,f){a[c+0]=d,a[c+1]=e,a[c+2]=f,a[c+3]=255}function drawGrayPixel(a,c,d,e){const f=a[c+0],h=a[c+1],g=a[c+2],b=blend(rgb2y(f,h,g),d*a[c+3]/255);drawPixel(e,c,b,b,b)}self.onmessage=a=>{img1=new Uint8ClampedArray(a.data.img1),img2=new Uint8ClampedArray(a.data.img2),diff=new Uint8ClampedArray(img1),width=a.data.width,height=a.data.height,init=a.data.init,key=a.data.key;try{pixelmatch(img1,img2,diff,width,height,init),self.postMessage({diff:diff.buffer,width:width,height:height,key:key},[diff.buffer])}catch(a){console.warn(a),self.postMessage({diff:null,key:key})}};', B = "let R,G,B;self.onmessage=(e=>{const a=e.data.key;if(e.data.R&&e.data.G&&e.data.B)R=new Uint8ClampedArray(e.data.R),G=new Uint8ClampedArray(e.data.G),B=new Uint8ClampedArray(e.data.B),self.postMessage({result:!0});else{const t=new Uint8ClampedArray(e.data.img),l=new Uint8ClampedArray(t),s=e.data.width,r=e.data.height;try{for(let e=0;e<r;++e)for(let a=0;a<s;++a){let r=4*a+e*s*4;l[r]=R[t[r]],l[r+1]=G[t[r+1]],l[r+2]=B[t[r+2]],l[r+3]=t[r+3]}self.postMessage({filter:l.buffer,width:s,height:r,key:a},[l.buffer])}catch(e){console.warn(e),self.postMessage({filter:null,key:a})}}});"; try { const e = new Blob([G], { type: "application/javascript" }); D = new Worker(r.createObjectURL(e)), D.keyPool = {}, r.revokeObjectURL(e); const t = new Blob([B], { type: "application/javascript" }), a = r.createObjectURL(t); S = new Worker(a), S.keyPool = {}; const n = o(S, P, A, M); L = new Worker(a), L.keyPool = {}; const s = o(L, j, E, R); r.revokeObjectURL(a), F = Promise.all([n, s]) } catch (e) { try { const e = `data:application/javascript,${encodeURIComponent(G)}`; D = new Worker(e), D.keyPool = {}; const t = `data:application/javascript,${encodeURIComponent(B)}`; S = new Worker(t), S.keyPool = {}; const a = o(S, P, A, M); L = new Worker(t), L.keyPool = {}; const r = o(L, j, E, R); F = Promise.all([a, r]) } catch (e) { D = null, S = null } } const W = e("<div>").css({ top: "50%", left: "50%", "z-index": 2147483647, position: "fixed", transform: "translate(-50%, -50%)", opacity: "0", "vertical-align": "middle", "pointer-events": "none", transition: "all 0.1s", "font-size": "500%", color: "yellow", "font-weight": "bold" }), q = e("<div/>").css({ id: "easy-compare-overlay", position: "fixed", top: 0, right: 0, bottom: 0, left: 0, "z-index": 2147483646, "background-color": "rgba(0, 0, 0, 0.75)", "pointer-events": "none", display: "none" }).append(W), O = e('<svg xmlns="http://www.w3.org/2000/svg">\n<path id="ld" d="M20 6H10c-2.21 0-4 1.79-4 4v28c0 2.21 1.79 4 4 4h10v4h4V2h-4v4zm0 30H10l10-12v12zM38 6H28v4h10v26L28 24v18h10c2.21 0 4-1.79 4-4V10c0-2.21-1.79-4-4-4z"/>\n</svg>').attr({ width: "30", height: "30", viewBox: "0 0 48 48", stroke: "white", "stroke-width": "5px", fill: "gray" }).css({ position: "fixed", top: "15px", right: "15px", "z-index": 2147483647, "paint-order": "stroke", opacity: 0, transition: "all 0.2s", cursor: "auto" }).on("mouseenter", t => { e(t.currentTarget).attr({ fill: "gray" }).css({ opacity: .2 }), C = setTimeout(() => w(e(t.currentTarget)), q[0].state ? 0 : 1e3) }).on("mouseleave", t => { clearTimeout(C), e(t.currentTarget).attr({ fill: "gray" }).css({ cursor: "auto", opacity: 0 })[0].state = !1 }).click(t => { if (t.currentTarget.state) switch (q[0].state) { case !1: x(q, e(':not("#easy-compare-overlay") img:visible'), W); break; case !0: k(q, e(':not("#easy-compare-overlay") img:visible')) } else { let e = t.clientX, a = t.clientY; const r = document.elementsFromPoint(e, a).find(e => !["svg", "path"].includes(e.tagName)); r.click() } }).mousedown(t => { t.currentTarget.state && e(t.currentTarget).attr({ fill: "#006000" }) }).mouseup(t => { t.currentTarget.state && e(t.currentTarget).attr({ fill: "#008000" }) }); q[0].state = !1, O[0].state = !1, e("body").append(O).append(q) })(window.$.noConflict(!0), unsafeWindow.Mousetrap, window.pixelmatch, unsafeWindow.URL.createObjectURL ? unsafeWindow.URL : unsafeWindow.webkitURL);