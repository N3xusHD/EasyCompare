// ==UserScript==
// @name               Easy Compare
// @description        Compare images
// @version            0.8.5
// @author             Secant (TYT@NexusHD)
// @license            GPL-3.0-or-later
// @supportURL         zzwu@zju.edu.cn
// @contributionURL    https://i.loli.net/2020/02/28/JPGgHc3UMwXedhv.jpg
// @contributionAmount 10
// @include            *
// @require            https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js
// @require            https://bundle.run/pixelmatch@5.1.0
// @namespace          https://greasyfork.org/users/152136
// @icon               data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23008000'%3E%3Cpath id='ld' d='M20 6H10c-2.21 0-4 1.79-4 4v28c0 2.21 1.79 4 4 4h10v4h4V2h-4v4zm0 30H10l10-12v12zM38 6H28v4h10v26L28 24v18h10c2.21 0 4-1.79 4-4V10c0-2.21-1.79-4-4-4z'/%3E%3C/svg%3E
// @grant              GM_xmlhttpRequest
// @grant              GM_download
// @grant              GM_getValue
// @grant              GM_setValue
// @grant              unsafewindow
// @connect            hdbits.org
// @connect            awesome-hd.me
// @connect            ptpimg.me
// @connect            imgbox.com
// @connect            malzo.com
// @connect            imagebam.com
// @connect            pixhost.to
// @connect            loli.net
// @connect            funkyimg.com
// @connect            ilikeshots.club
// @connect            z4a.net
// @connect            picgd.com
// @connect            tu.totheglory.im
// @connect            tpimg.ccache.org
// @connect            pterclub.com
// @connect            catbox.moe
// @connect            *
// ==/UserScript==
// jshint ignore: start
(async function(e,t,a,r){"use strict";function o(e,t=5,a=5.5){const r=a*Math.PI-128/t,o=-1/4194304*r,n=3/32768*r,s=1/t;return Math.round(127.9999*Math.sin(o*e**3+n*e**2+s*e-Math.PI/2)+127.5)||0}async function n(e,[t,a,r]){return new Promise(o=>{e.onmessage=(e=>{o(e.data.result)}),e.postMessage({R:t.buffer,G:a.buffer,B:r.buffer},[t.buffer,a.buffer,r.buffer])})}function s(t){return e(t,document.implementation.createHTMLDocument("virtual"))}function i(t="red"){const a=e("<figure/>").css({width:"fit-content",position:"fixed",top:"50%",left:"50%",margin:"0","vertical-align":"middle"}),r=e("<canvas/>").css({display:"none",transform:"translate(-50%, -50%)",opacity:"1",outline:"3px solid "+t,"outline-offset":"2px"});return a.append(r),r[0]}function c(e,t,a="16px sans serif",r="rgba(255,255,255,255)"){const o=e.getContext("2d");o.font=a,e.width=o.measureText(t).width,e.height=20,o.font=a,o.fillStyle=r,o.fillText(t,0,15)}function l(e,t){e.width=t.width,e.height=t.height,e.getContext("2d").putImageData(t,0,0)}function d(e){return new Promise(t=>{GM_xmlhttpRequest({url:e,method:"GET",timeout:6e3,onload:e=>{if(200===e.status)try{const a=s(e.responseText),r=a.find($.join(","))[0].src;let o=r;for(let e of M)if(o=o.replace(e[0],e[1]),o!==r)break;t(o)}catch(e){console.warn(e),t(null)}else console.warn(e),t(null)},ontimeout:e=>{console.warn(e),t(null)}})})}function g(e,t,a,r,o){const[n,s,i]=o;for(let o=0;o<r;++o)for(let r=0;r<a;++r){let c=4*r+o*a*4;t[c]=n[e[c]],t[c+1]=s[e[c+1]],t[c+2]=i[e[c+2]],t[c+3]=e[c+3]}}async function m(e,t){return new Promise(a=>{GM_xmlhttpRequest({url:e,method:"GET",overrideMimeType:"text/plain; charset=x-user-defined",onprogress:e=>{"function"==typeof t&&(-1!==e.total?t(e.loaded/e.total):t(-e.loaded))},onload:t=>{if(200===t.status){const r=t.responseText,o=r.length,n=new Uint8Array(o);for(let e=0;e<o;e++)n[e]=255&r.charCodeAt(e);const s=(t.responseHeaders.match(/content\-type: *(.+)$/m)||["","image/png"])[1];let i;switch(s){case"image/apng":i=".apng";break;case"image/bmp":i=".bmp";break;case"image/gif":i=".gif";break;case"image/x-icon":i=".ico";break;case"image/jpeg":i=".jpg";break;case"image/png":i=".png";break;case"image/svg+xml":i=".svg";break;case"image/tiff":i=".tiff";break;case"image/webp":i=".webp";break;default:if("image"===s.slice(0,5)){let e=s.match(/\/(.*)/);i=e?"."+e:""}else i=(e.match(/\.[^\.]+$/)||[""])[0]}createImageBitmap(new Blob([n],{type:s})).then(e=>{const[t,r]=[e.width,e.height],o=document.createElement("canvas");o.width=t,o.height=r;const n=o.getContext("2d");n.drawImage(e,0,0),e.close(),a({imageData:new ImageData(n.getImageData(0,0,t,r).data,t,r),extension:i})})}else console.warn(t),a(null)},onerror:e=>{console.warn(e),a(null)}})})}async function f(e,t,r={alpha:.5,threshold:.007},o=A){if(e&&t&&e.width===t.width&&e.height===t.height){if(o){const[a,n,s,i]=[e.data.buffer,t.data.buffer,e.width,e.height],c=""+Date.now();return o.onmessage=(e=>{const t=e.data.key,a=o.keyPool[t];a&&a(new ImageData(new Uint8ClampedArray(e.data.diff),e.data.width,e.data.height))}),o.postMessage({img1:a,img2:n,width:s,height:i,init:r,key:c},[a,n]),new Promise(e=>{o.keyPool[c]=e})}{const[o,n,s,i]=[e.data,t.data,e.width,e.height],c=new Uint8ClampedArray(o);return a(o,n,c,s,i,r),new ImageData(c,s,i)}}return null}async function p(e,t){if(e){if(t instanceof Worker){const a=t,[r,o,n]=[e.data.buffer,e.width,e.height],s=""+Date.now();return a.onmessage=(e=>{const t=e.data.key,r=a.keyPool[t];r&&r(new ImageData(new Uint8ClampedArray(e.data.filter),e.data.width,e.data.height))}),await E,a.postMessage({img:r,width:o,height:n,key:s},[r]),new Promise(e=>{a.keyPool[s]=e})}{const a=t,[r,o,n]=[e.data,e.width,e.height],s=new Uint8ClampedArray(r);return g(r,s,o,n,a),new ImageData(s,o,n)}}return null}function h(e,t){if(e.easyCompare&&e.easyCompare.originalImage){const t=e.easyCompare.originalImage;return t.ready&&(t.style.width=`${100*I}%`),t}{const a=i(),r=e=>{null!==e&&e>=0?c(a,`Loading ${(100*e).toFixed(1)}%`):e<0&&c(a,"Loading...")},o=(e,t,r)=>{m(e,t).then(({imageData:t,extension:o})=>{r(t),a.src=e,a.ext=o,l(a,t),a.style.width=`${100*I}%`,a.ready=!0})};return c(a,"Loading..."),a.ready=!1,a.targetImage=e,t.append(a.parentElement),e.easyCompare||(e.easyCompare={}),e.easyCompare.originalImage=a,e.easyCompare.originalImagePromise=(t=>new Promise(async a=>{let r,n,s=e.src;for(let r of M)if(s=s.replace(r[0],r[1]),s!==e.src)return void o(s,t,a);if(n=e.parentElement.href,r=n){for(let e of P)if(r=r.replace(e[0],e[1]),r!==n)break;r.match(/\.png$|\.jpe?g$|\.webp|\.gif|\.bmp|\.svg$/)?o(r,t,a):d(r).then(e=>{o(e||s,t,a)})}else o(s,t,a)})),e.easyCompare.originalImagePromise(r),a}}function u(e,t,a){if(e.src===t.src)return h(e);if(e.easyCompare&&e.easyCompare[t.src]){e.easyCompare[t.src].targetImage=e,e.easyCompare[t.src].baseImage=t;const a=e.easyCompare[t.src];return a.ready&&(a.style.width=`${100*I}%`),a}{const r=i();c(r,"Loading..."),r.ready=!1,r.targetImage=e,r.baseImage=t,r.threshold=-1,r.step=.001,a.append(r.parentElement),e.easyCompare||(e.easyCompare={}),e.easyCompare[t.src]=r,t.easyCompare||(t.easyCompare={}),t.easyCompare[e.src]=r;let o=[0,0];const n=(e,t)=>{null!==e&&e>=0&&null!==t?(o[t]=e,c(r,`Loading ${(50*(o[0]+o[1])).toFixed(1)}%`)):c(r,e<0?"Loading...":"Diffing...")};return h(e,a),h(t,a),Promise.all([e.easyCompare.originalImagePromise(e=>n(e,0)),t.easyCompare.originalImagePromise(e=>n(e,1))]).then(e=>(n(null,null),f(...e,{alpha:.5,threshold:.007}))).then(e=>{null===e?c(r,"Sizes Not Match"):(l(r,e),r.threshold=.007,r.style.width=`${100*I}%`,r.ready=!0)}).catch(e=>{console.warn(e),c(r,"Something Went Wrong")}),r}}function y(e,t,a){if(e.easyCompare&&e.easyCompare[t]){const a=e.easyCompare[t];return a.ready&&(a.style.width=`${100*I}%`),a}{const r=i();c(r,"Loading..."),r.ready=!1,r.targetImage=e,a.append(r.parentElement),e.easyCompare||(e.easyCompare={}),e.easyCompare[t]=r;const o=e=>{c(r,null!==e&&e>=0?`Loading ${(100*e).toFixed(1)}%`:e<0?"Loading...":"Filtering...")};return h(e,a),e.easyCompare.originalImagePromise(o).then(e=>(o(null),T[t](e))).then(e=>{l(r,e),r.style.width=`${100*I}%`,r.ready=!0}),r}}function w(e){return e.find("canvas:visible")}function b(e){e.attr({fill:"#008000"}).css({cursor:"pointer",opacity:"1"})[0].state=!0}function k(t,a){const r=w(t).hide()[0];(r&&(a=r.targetImage)||a)&&a.easyCompare&&void 0!==a.easyCompare.boxShadow&&e(a).css("box-shadow",a.easyCompare.boxShadow)}function x(a,r,o){function n(){try{b=w(a)[0].targetImage}catch(e){b=void 0,e instanceof TypeError||console.warn(e)}}function s(e="easycompare"){try{const t=w(a)[0],r=t.src||t.toDataURL("image/png").replace(/^data:image\/[^;]/,"data:application/octet-stream"),o=t.ext||"";GM_download({url:r,name:e+o})}catch(e){e instanceof TypeError||console.warn(e)}}function i(t){P=P===t?"none":t;try{const t=w(a).hide()[0];let r;r=e("none"===P?h(t.targetImage,a):y(t.targetImage,P,a)),r.css("outline-color",t.style["outline-color"]).show()}catch(e){e instanceof TypeError||console.warn(e)}}function c(e){try{e&&I<1.95?I+=.1:!e&&I>.15&&(I-=.1);const t=w(a)[0];t.ready&&(t.style.width=`${100*I}%`),o.text(`Zoom: ${parseInt(100*I)}%`).css("opacity","1"),setTimeout(()=>{o.css("opacity","0")},$)}catch(e){e instanceof TypeError||console.warn(e)}}function l(){try{if(1!==I){I=1;const e=w(a)[0];e.ready&&(e.style.width=`${100*I}%`),o.text("Zoom: 100%").css("opacity","1"),setTimeout(()=>{o.css("opacity","0")},$)}}catch(e){e instanceof TypeError||console.warn(e)}}function d(e){try{const t=w(a)[0];let r=t.threshold;if(void 0!==r&&r>=0){const a=r;o.text(`Threshold: ${a.toFixed(4)}`).css("opacity","1"),e?(r+=t.step,r>1&&(r=1)):(r-=t.step,r<0&&(r=0)),t.threshold=-1;const[n,s]=[t.baseImage.easyCompare.originalImage,t.targetImage.easyCompare.originalImage];f(n.getContext("2d").getImageData(0,0,n.width,n.height),s.getContext("2d").getImageData(0,0,s.width,s.height),{alpha:.5,threshold:r}).then(e=>{t.getContext("2d").putImageData(e,0,0),o.text(`Threshold: ${r.toFixed(4)}`).css("opacity","1"),setTimeout(()=>{t.threshold=r,o.css("opacity","0")},$)})}}catch(e){e instanceof TypeError||console.warn(e)}}function g(e){try{const t=w(a)[0];let r=t.step;r&&(t.step=e&&r<=.1?10*r:e?1:!e&&r>=.001?r/10:1e-4,o.text(`Step: ${t.step.toFixed(4)}`).css("opacity","1"),setTimeout(()=>o.css("opacity","0"),$))}catch(e){e instanceof TypeError||console.warn(e)}}function m(){try{k(a,w(a)[0].targetImage)}catch(e){e instanceof TypeError||console.warn(e)}a.find("canvas").toArray().forEach(e=>{const t=e.targetImage;delete t.easyCompare,e.parentElement.remove()})}function p(t,o){try{const n=w(a)[0].targetImage,s=r.index(n);k(a,n);const i=r[t?s-M:s+M]||r[s];e(i).trigger("mouseenter",[o])}catch(e){e instanceof TypeError||console.warn(e)}}t&&t.pause(),a.show()[0].state=!0;let b,x=["red","blue"],M=1,P="none",$=300;r.on("mouseenter.compare",(t,r)=>{const o=t.currentTarget;let n;if(clearTimeout(v),k(a),o.easyCompare||(o.easyCompare={},o.easyCompare.boxShadow=o.style["box-shadow"]),e(o).css({"box-shadow":"0px 0px 8px "+x[0]}),(t.shiftKey||r)&&b)n=e(u(o,b,a)).css("outline-color",x[0]).show();else switch(P){case"none":n=e(h(o,a)).css("outline-color",x[0]).show();break;default:n=e(y(o,P,a)).css("outline-color",x[0]).show()}x.push(x.shift())}).on("mouseleave.compare",e=>{const t=e.currentTarget;v=setTimeout(()=>{k(a,t)},200)}),e(document).on("scroll.compare",t=>{const o=w(a)[0];if(o){const t=e(o.targetImage);t.is(":hover")||(k(a,t[0]),r.find("img:hover").trigger("mousenter"))}}).on("keydown.compare",e=>{switch(e.preventDefault(),e.stopImmediatePropagation(),e.key){case"Escape":C(a,r);break;case"Shift":n();break;case"+":case"=":e.ctrlKey&&c(!0);break;case"-":case"_":e.ctrlKey&&c(!1);break;case"O":case"o":e.ctrlKey&&l();break;case"S":case"s":e.ctrlKey?s():i("solar");break;case"A":case"a":i("s2lar");break;case"I":case"i":case"ArrowUp":d(!0);break;case"K":case"k":case"ArrowDown":d(!1);break;case"J":case"j":case"ArrowLeft":g(!0);break;case"L":case"l":case"ArrowRight":e.ctrlKey?m():g(!1);break;case"Q":case"q":a.css("opacity",.5);break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":M=parseInt(e.key);break;case"0":M=10;break;case"W":case"w":p(!0,e.shiftKey);break;case"E":case"e":p(!1,e.shiftKey)}return!1}).on("keyup.compare",e=>{switch(e.preventDefault(),e.stopImmediatePropagation(),e.key){case"Q":case"q":a.css("opacity","")}return!1})}function C(a,r){t&&t.unpause(),k(a),a.hide()[0].state=!1,r.off("mouseenter.compare").off("mouseleave.compare"),e(document).off("scroll.compare").off("keydown.compare")}if(t){let e=t.prototype||t;const a=e.stopCallback;e.stopCallback=function(e,t,r){var o=this;return!!o.paused||a.call(o,e,t,r)},e.pause=function(){var e=this;e.paused=!0},e.unpause=function(){var e=this;e.paused=!1}}let v,I=1;const M=[[/\.thumb\.jpe?g$/,""],[/\.md\.png$/,".png"],[/\.th\.png$/,".png"],[/_thumb\.png$/,".png"],[/img\.awesome\-hd\.me\/t(\/\d+)?\//,"img.awesome-hd.me/images/"],[/thumbs((?:\d+)?\.imgbox\.com\/.+_)t\.png$/,"images$1o.png"],[/t((?:\d+)?\.pixhost\.to\/)thumbs\//,"img$1images/"],[/t(\.hdbits\.org\/.+)\.jpg$/,"i$1.png"],[/^.*?imagecache\.php\?url=(https?)%3A%2F%2Fthumbs(\d+)?\.imgbox\.com%2F(\w+)%2F(\w+)%2F(\w+)_t\.png/,"$1://images$2.imgbox.com/$3/$4/$5_o.png"]],P=[[/^https?:\/\/anonym\.to\/\?(.*)$/,(e,t)=>decodeURIComponent(t)],[/^https?:\/\/www\.dereferer\.org\/\?(.*)$/,(e,t)=>decodeURIComponent(t)],[/^(?:https?:\/\/pterclub\.com)?\/link\.php\?sign=.+?&target=(.*)$/,(e,t)=>decodeURIComponent(t.replace(/\+/g," ")).replace(/ /g,"%20")],[/^.*?imagecache\.php\?url=(.*)$/,(e,t)=>decodeURIComponent(t.replace(/\+/g," ")).replace(/ /g,"%20")]],$=["#image-viewer-container>img",".image-container img","div.img.big>img","img.mainimage","img#img"],T={solar:e=>p(e,j||D),s2lar:e=>p(e,U||R)};let A,j,U,E,D=GM_getValue("solarCurve"),R=GM_getValue("s2larCurve");D?(D=JSON.parse(D),R=JSON.parse(R)):(D=[Array.from({length:256},(e,t)=>o(t)),Array.from({length:256},(e,t)=>o(t-5)),Array.from({length:256},(e,t)=>o(t+5))],GM_setValue("solarCurve",JSON.stringify(D)),R=[Array.from({length:256},(e,t)=>D[0][[D[0][t]]]),Array.from({length:256},(e,t)=>D[1][[D[1][t]]]),Array.from({length:256},(e,t)=>D[2][[D[2][t]]])],GM_setValue("s2larCurve",JSON.stringify(R))),D=D.map(e=>new Uint8Array(e)),R=R.map(e=>new Uint8Array(e));const L='const defaultOptions={threshold:.1,includeAA:!1,alpha:.1,aaColor:[255,255,0],diffColor:[255,0,0],diffMask:!1};function pixelmatch(a,b,c,d,e,f){if(!isPixelData(a)||!isPixelData(b)||c&&!isPixelData(c))throw new Error("Image data: Uint8Array, Uint8ClampedArray or Buffer expected.");if(a.length!==b.length||c&&c.length!==a.length)throw new Error("Image sizes do not match.");if(a.length!==4*(d*e))throw new Error("Image data size does not match width/height.");f=Object.assign({},defaultOptions,f);const g=d*e,h=new Uint32Array(a.buffer,a.byteOffset,g),j=new Uint32Array(b.buffer,b.byteOffset,g);let k=!0;for(let l=0;l<g;l++)if(h[l]!==j[l]){k=!1;break}if(k){if(c&&!f.diffMask)for(let b=0;b<g;b++)drawGrayPixel(a,4*b,f.alpha,c);return 0}const l=35215*f.threshold*f.threshold;let m=0;const[n,o,p]=f.aaColor,[q,r,s]=f.diffColor;for(let g=0;g<e;g++)for(let h=0;h<d;h++){const i=4*(g*d+h),j=colorDelta(a,b,i,i);j>l?!f.includeAA&&(antialiased(a,h,g,d,e,b)||antialiased(b,h,g,d,e,a))?c&&!f.diffMask&&drawPixel(c,i,n,o,p):(c&&drawPixel(c,i,q,r,s),m++):c&&!f.diffMask&&drawGrayPixel(a,i,f.alpha,c)}return m}function isPixelData(a){return ArrayBuffer.isView(a)&&1===a.constructor.BYTES_PER_ELEMENT}function antialiased(a,b,c,d,e,f){const g=Math.max(b-1,0),h=Math.max(c-1,0),i=Math.min(b+1,d-1),j=Math.min(c+1,e-1);let k,l,m,n,o=b===g||b===i||c===h||c===j?1:0,p=0,q=0;for(let r=g;r<=i;r++)for(let e=h;e<=j;e++){if(r===b&&e===c)continue;const f=colorDelta(a,a,4*(c*d+b),4*(e*d+r),!0);if(0!==f)f<p?(p=f,k=r,l=e):f>q&&(q=f,m=r,n=e);else if(o++,2<o)return!1}return 0!==p&&0!==q&&(hasManySiblings(a,k,l,d,e)&&hasManySiblings(f,k,l,d,e)||hasManySiblings(a,m,n,d,e)&&hasManySiblings(f,m,n,d,e))}function hasManySiblings(a,b,c,d,e){const f=Math.max(b-1,0),g=Math.max(c-1,0),h=Math.min(b+1,d-1),i=Math.min(c+1,e-1),j=4*(c*d+b);let k=b===f||b===h||c===g||c===i?1:0;for(let l=f;l<=h;l++)for(let e=g;e<=i;e++){if(l===b&&e===c)continue;const f=4*(e*d+l);if(a[j]===a[f]&&a[j+1]===a[f+1]&&a[j+2]===a[f+2]&&a[j+3]===a[f+3]&&k++,2<k)return!0}return!1}function colorDelta(a,b,c,d,e){let f=a[c+0],g=a[c+1],h=a[c+2],j=a[c+3],k=b[d+0],l=b[d+1],m=b[d+2],n=b[d+3];if(j===n&&f===k&&g===l&&h===m)return 0;255>j&&(j/=255,f=blend(f,j),g=blend(g,j),h=blend(h,j)),255>n&&(n/=255,k=blend(k,n),l=blend(l,n),m=blend(m,n));const o=rgb2y(f,g,h)-rgb2y(k,l,m);if(e)return o;const p=rgb2i(f,g,h)-rgb2i(k,l,m),i=rgb2q(f,g,h)-rgb2q(k,l,m);return .5053*o*o+.299*p*p+.1957*i*i}function rgb2y(a,c,d){return .29889531*a+.58662247*c+.11448223*d}function rgb2i(a,c,d){return .59597799*a-.2741761*c-.32180189*d}function rgb2q(a,c,d){return .21147017*a-.52261711*c+.31114694*d}function blend(b,c){return 255+(b-255)*c}function drawPixel(a,c,d,e,f){a[c+0]=d,a[c+1]=e,a[c+2]=f,a[c+3]=255}function drawGrayPixel(a,c,d,e){const f=a[c+0],h=a[c+1],g=a[c+2],b=blend(rgb2y(f,h,g),d*a[c+3]/255);drawPixel(e,c,b,b,b)}self.onmessage=a=>{img1=new Uint8ClampedArray(a.data.img1),img2=new Uint8ClampedArray(a.data.img2),diff=new Uint8ClampedArray(img1),width=a.data.width,height=a.data.height,init=a.data.init,key=a.data.key;try{pixelmatch(img1,img2,diff,width,height,init),self.postMessage({diff:diff.buffer,width:width,height:height,key:key},[diff.buffer])}catch(a){console.warn(a),self.postMessage({diff:null,key:key})}};',S="let R,G,B;self.onmessage=(e=>{const a=e.data.key;if(e.data.R&&e.data.G&&e.data.B)R=new Uint8ClampedArray(e.data.R),G=new Uint8ClampedArray(e.data.G),B=new Uint8ClampedArray(e.data.B),self.postMessage({result:!0});else{const t=new Uint8ClampedArray(e.data.img),l=new Uint8ClampedArray(t),s=e.data.width,r=e.data.height;try{for(let e=0;e<r;++e)for(let a=0;a<s;++a){let r=4*a+e*s*4;l[r]=R[t[r]],l[r+1]=G[t[r+1]],l[r+2]=B[t[r+2]],l[r+3]=t[r+3]}self.postMessage({filter:l.buffer,width:s,height:r,key:a},[l.buffer])}catch(e){console.warn(e),self.postMessage({filter:null,key:a})}}});";try{const e=new Blob([L],{type:"application/javascript"});A=new Worker(r.createObjectURL(e)),A.keyPool={},r.revokeObjectURL(e);const t=new Blob([S],{type:"application/javascript"}),a=r.createObjectURL(t);j=new Worker(a),j.keyPool={};const o=n(j,D);U=new Worker(a),U.keyPool={};const s=n(U,R);r.revokeObjectURL(a),E=Promise.all([o,s])}catch(e){try{const e=`data:application/javascript,${encodeURIComponent(L)}`;A=new Worker(e),A.keyPool={};const t=`data:application/javascript,${encodeURIComponent(S)}`;j=new Worker(t),j.keyPool={};const a=n(j,D);U=new Worker(t),U.keyPool={};const r=n(U,R);E=Promise.all([a,r])}catch(e){A=null,j=null}}const G=e("<div>").css({top:"50%",left:"50%","z-index":2147483647,position:"fixed",transform:"translate(-50%, -50%)",opacity:"0","vertical-align":"middle","pointer-events":"none",transition:"all 0.1s","font-size":"500%",color:"yellow","font-weight":"bold"}),O=e("<div/>").css({id:"easy-compare-overlay",position:"fixed",top:0,right:0,bottom:0,left:0,"z-index":2147483646,"background-color":"rgba(0, 0, 0, 0.75)","pointer-events":"none",display:"none"}).append(G),B=e('<svg xmlns="http://www.w3.org/2000/svg">\n<path id="ld" d="M20 6H10c-2.21 0-4 1.79-4 4v28c0 2.21 1.79 4 4 4h10v4h4V2h-4v4zm0 30H10l10-12v12zM38 6H28v4h10v26L28 24v18h10c2.21 0 4-1.79 4-4V10c0-2.21-1.79-4-4-4z"/>\n</svg>').attr({width:"30",height:"30",viewBox:"0 0 48 48",stroke:"white","stroke-width":"5px",fill:"gray"}).css({position:"fixed",top:"15px",right:"15px","z-index":2147483647,"paint-order":"stroke",opacity:0,transition:"all 0.2s",cursor:"auto"}).on("mouseenter",t=>{e(t.currentTarget).attr({fill:"gray"}).css({opacity:.2}),v=setTimeout(()=>b(e(t.currentTarget)),O[0].state?0:1e3)}).on("mouseleave",t=>{clearTimeout(v),e(t.currentTarget).attr({fill:"gray"}).css({cursor:"auto",opacity:0})[0].state=!1}).click(t=>{if(t.currentTarget.state)switch(O[0].state){case!1:x(O,e(':not("#easy-compare-overlay") img:visible'),G);break;case!0:C(O,e(':not("#easy-compare-overlay") img:visible'))}else{let e=t.clientX,a=t.clientY;const r=document.elementsFromPoint(e,a).find(e=>!["svg","path"].includes(e.tagName));r.click()}}).mousedown(t=>{t.currentTarget.state&&e(t.currentTarget).attr({fill:"#006000"})}).mouseup(t=>{t.currentTarget.state&&e(t.currentTarget).attr({fill:"#008000"})});O[0].state=!1,B[0].state=!1,e("body").append(B).append(O)})(window.$.noConflict(!0),unsafeWindow.Mousetrap,window.pixelmatch,unsafeWindow.URL.createObjectURL?unsafeWindow.URL:unsafeWindow.webkitURL);